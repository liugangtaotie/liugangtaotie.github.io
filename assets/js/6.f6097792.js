(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{595:function(t,s,a){t.exports=a.p+"assets/img/transform-framework.9fae09fa.png"},596:function(t,s,a){t.exports=a.p+"assets/img/webkit-architecture.450dc2ed.png"},597:function(t,s,a){t.exports=a.p+"assets/img/webkit-render.9abf6c96.png"},598:function(t,s,a){t.exports=a.p+"assets/img/webkit-jscore.ee051da3.png"},599:function(t,s,a){t.exports=a.p+"assets/img/blink-architecture.43eaf556.png"},600:function(t,s,a){t.exports=a.p+"assets/img/life-of-a-pixel.e3fad5aa.png"},601:function(t,s,a){t.exports=a.p+"assets/img/wx-mp-architecture.7e7b2004.png"},602:function(t,s,a){t.exports=a.p+"assets/img/wx-mp-flutter.d73b4d15.png"},603:function(t,s,a){t.exports=a.p+"assets/img/swan-mp-architecture.b5232cf4.png"},604:function(t,s,a){t.exports=a.p+"assets/img/ali-mp-architecture.629d781d.png"},605:function(t,s,a){t.exports=a.p+"assets/img/quickapp-architecture.7f65a6db.png"},606:function(t,s,a){t.exports=a.p+"assets/img/emp-js.01611c1c.png"},607:function(t,s,a){t.exports=a.p+"assets/img/emp-sdk-architecture.1db4685e.png"},608:function(t,s,a){t.exports=a.p+"assets/img/launch-process.2406ed4d.png"},609:function(t,s,a){t.exports=a.p+"assets/img/miniprogram-translater.cd4de67f.png"},610:function(t,s){t.exports="data:image/png;base64,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yy+XZcuWZSdyww03yMiRI/M1l7feekvat2+vtAf6BO267777lKn9+eefUqJEidSAyWP2gAED5J9//lF6mTiefPJJufrqq+XXX3/N8fM2bdrIUUcdJaNGjSr0tbFApKFPPfWUwuLrr7+WOnXqpLR2SqbUpEkTlVji+M9//qMMJJ0jMqXMzEypVauWlC5dWoHcq1cvwe/Gjx8vw4YNU3//+eefpV69evLdd99JpUqV5LfffpM777xTpk+fLn/88YeUKlUqR2hbt26Vb775Rk455RSjppTfdQqDFU2pMOiZ+ezemBLvJf1axOle2rRpkxJxmBKMBdr0wQcfyPnnny+9e/eWwYMHJ01s6dKl0rJlS2UM9957r8DcoGPpNCVsWHfv3q0MMnHMnj1bunfvXuSmBOOtW7eufrFFJCVTateundx00017XOCvv/4S3GToQB555BEpU6aMMoZp06bJa6+9Jmeffbb6OQzjoosuEqwzceJEtc7999+vOp7EkWhKKDqMCeucddZZahp2FUOHDpUePXrItm3blClt2LBBKleurH6PTgc7EpB51apVigCNGzeWWbNmydSpUxWZMAet5t133y2PP/64VK1aVQ4//HDZvn27+t0XX3wh2P2sX79eLrvsMvnkk09UrCAQSNivXz9lbs2aNZPRo0fvYcwfffRR9nUmT54sP/30k4oFndgJJ5wgjz76qMIA8Ue7FFyza9euag7MFib88ccfq6LiGugQE00Jn73iiivk1FNPVd2TTlwpsWMvJ6cq0nt5mdh8LNV80SnxXnLzXoJePPTQQ7Jy5cocXdH8+fOVyaBTQQcFjYEJnXTSSXLLLbfIGWecof6dzJSgl+gyypUrp7on8AMD60J3oDVNmzZVugedgvHcc889SkOwGe/Zs6fg1CrRlD799FOlkeAnNLUgU0oWN3QFMUBnH374YTnooINUY4CNfTINjTqlyJSSaRM8AroIfcRjE2hlSqYEQW7dunUOMQBQJUuWVDsGHJtlZGTIhAkT5I033lBdFYqAFhFODVHFGijUiBEjlPji6A/n24lnqommBCDQ/m3cuFEJNgwOBhg9VwIRMAeiXbZsWTUPiZ1zzjmKPCAC5teuXVtuvvlmqVatWvbxXbR7QNH+/vtvVdC2bdsqU2rQoIEcf/zxKl90ae+9955qt3HdQw45RK6//nplsPgddj5v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"},611:function(t,s){t.exports="data:image/png;base64,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"},612:function(t,s,a){t.exports=a.p+"assets/img/jsbridge-publish-subscribe.3b25b0bc.png"},756:function(t,s,a){"use strict";a.r(s);var n=a(4),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("Boxx",{attrs:{changeTime:"5000"}}),t._v(" "),n("h2",{attrs:{id:"背景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),n("p",[t._v("本文正式开篇讲实现原理之前，我想先简单说明一下小程序领域的现状，以及 EMP 框架研究方向的出发点和个人思考。目前基于统一的 DSL (Vue/React/自定义DSL) 转换到各家的小程序\b的框架一大堆，比如 mpvue、uni-app、Taro 等，这些框架解决的核心问题是实现一套开发代码编译到多端小程序。")]),t._v(" "),n("p",[t._v("如果我们想从零开始做一个类似微信小程序的引擎，或者将微信小程序现有资源转换成 H5 容器、App 容器能够运行的资源，那么和一套 DSL 编译到各个平台的思路是恰好相反的。我们需要搞清楚小程序在小程序引擎是怎么跑起来的，各家小程序引擎实现机制不太一样，但是基本上都是参考微信小程序引擎做的实现，保留了小程序的双线程模型。各小程序平台的基础库是不一样的，微信小程序开发框架是 mina 框架，百度小程序小程序开发框架是 swan 框架，视图层都有一套自己实现的 mvvm 框架，逻辑层就相对比较一致，都是 JavaScript 引擎，无非是基于 V8 或 JavaScriptCore。")]),t._v(" "),n("p",[t._v("目前小程序相关的框架可以分成以下大类：")]),t._v(" "),n("ul",[n("li",[t._v("统一的 DSL 编译到多平台小程序、H5、App，实现应用跨多端运行，典型的框架："),n("a",{attrs:{href:"https://github.com/Meituan-Dianping/mpvue",target:"_blank",rel:"noopener noreferrer"}},[t._v("mpvue"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"https://github.com/dcloudio/uni-app",target:"_blank",rel:"noopener noreferrer"}},[t._v("uni-app"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"https://github.com/max-team/Mars",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mars"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"https://github.com/NervJS/taro",target:"_blank",rel:"noopener noreferrer"}},[t._v("Taro"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"https://rubylouvre.github.io/nanachi/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nanachi"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"https://github.com/didi/chameleon",target:"_blank",rel:"noopener noreferrer"}},[t._v("Chameleon"),n("OutboundLink")],1),t._v("；")]),t._v(" "),n("li",[t._v("多平台小程序之间互相转换，实现小程序之间跨端运行，典型的框架："),n("a",{attrs:{href:"https://ant-move.github.io/website/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Antmove"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"https://smartprogram.baidu.com/docs/develop/tutorial/move",target:"_blank",rel:"noopener noreferrer"}},[t._v("wx2swan"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"https://www.npmjs.com/package/@qihoo/wx2qh",target:"_blank",rel:"noopener noreferrer"}},[t._v("@qihoo/wx2qh"),n("OutboundLink")],1),t._v("；")]),t._v(" "),n("li",[t._v("小程序编译到 Web、App 端运行，实现小程序资源的复用，典型的框架："),n("a",{attrs:{href:"https://github.com/chemzqm/wept",target:"_blank",rel:"noopener noreferrer"}},[t._v("wept"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"https://github.com/wdfe/weweb",target:"_blank",rel:"noopener noreferrer"}},[t._v("weweb"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"https://github.com/weidian-inc/hera",target:"_blank",rel:"noopener noreferrer"}},[t._v("Hera"),n("OutboundLink")],1),t._v("；")]),t._v(" "),n("li",[t._v("类微信小程序的小程序引擎框架，典型的框架："),n("a",{attrs:{href:"https://github.com/swan-team/swan-js",target:"_blank",rel:"noopener noreferrer"}},[t._v("swan-js"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"https://github.com/weidian-inc/hera",target:"_blank",rel:"noopener noreferrer"}},[t._v("Hera"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"http://openapplus.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("OpenApp+"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"https://github.com/githubliruiyuan/HybridFlutter",target:"_blank",rel:"noopener noreferrer"}},[t._v("HybridFlutter"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"https://github.com/zhaomenghuan/flutter-mini-program",target:"_blank",rel:"noopener noreferrer"}},[t._v("flutter-mini-program"),n("OutboundLink")],1),t._v("。")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(595),alt:"Image text"}})]),t._v(" "),n("p",[t._v("小程序引擎可以参考的资料和内容比较少，目前可以借鉴的思路有两种：")]),t._v(" "),n("ul",[n("li",[t._v("参考微信小程序的实现，反编译微信开发者工具和基础库，基于 Hera 进行二次开发，将 Hera 中微信小程序开发框架 mina 框架(组件系统 "),n("a",{attrs:{href:"https://www.npmjs.com/package/miniprogram-exparser",target:"_blank",rel:"noopener noreferrer"}},[t._v("exparser"),n("OutboundLink")],1),t._v("、vdom 等) 换成 Vue.js 框架等成熟的前端框架，引入组件系统开发类微信规范的小程序组件；")]),t._v(" "),n("li",[t._v("参考百度小程序的实现，目前百度小程序前端核心框架 swan-js 开源，也可以考虑基于 swan 进行改造，比如有人将其中的 mvvm "),n("a",{attrs:{href:"https://baidu.github.io/san",target:"_blank",rel:"noopener noreferrer"}},[t._v("san"),n("OutboundLink")],1),t._v(" 框架换成了 Vue 框架，"),n("a",{attrs:{href:"https://github.com/handsomeliuyang/swanvue-core",target:"_blank",rel:"noopener noreferrer"}},[t._v("swanvue-core"),n("OutboundLink")],1),t._v("，然后去实现宿主容器。")])]),t._v(" "),n("p",[t._v("EMP 出发点来源于构建自定义小程序引擎时，尝试基于 Vue.js 框架作为视图层底层框架，然后组件标准和逻辑层模仿微信小程序，目前已经初步实现了简单的一个小程序容器。如果以 Vue 作为初始 DSL 直接开发小程序也不是不可以，但是小程序生态现有的资源无非直接复用，能不能将小程序转换成 Vue.js 框架能运行的代码呢，这就是 EMP 框架最初的起点，定位是一种小程序引擎的实现，保留小程序双线程模型，基于 Vue.js 框架实现视图层渲染容器，使用 JavaScript 引擎实现小程序逻辑层调用。")]),t._v(" "),n("h2",{attrs:{id:"小程序-native-web"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#小程序-native-web"}},[t._v("#")]),t._v(" 小程序 & Native & Web")]),t._v(" "),n("p",[t._v("从 PC 时代开始，Native 与 Web 就一直是相互竞争、相互融合的关系，我们先来简单看看它们之间的优势与劣势。")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"center"}}),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("Native")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("Web")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("性能")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("高")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("低")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("用户体验")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("好")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("白屏、交互反馈差")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("功能")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("可以充分利用平台自身的能力")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("只有使用 W3C 的标准能力")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("迭代")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("周期长，需要发布")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("周期短，随时发布")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("维护成本")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("高")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("低")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("跨平台")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("差")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("好")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("线程")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("多线程")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("单线程")])])])]),t._v(" "),n("p",[t._v("可以看出，Native 与 Web 之间各有优劣，在移动互联网发展的过程中，开发者们也一直在寻找融合双方优势的方案，经历了以下四个阶段的发展：")]),t._v(" "),n("ul",[n("li",[t._v("Hybrid 1.0：为 Web 页面提供 Naive API 的能力，也就是用 JS Bridge 去增强系统的 WebView 的功能。缺点是：体验差，如滚动、动画与交互等，稳定性差，如列表内存占用大等。")]),t._v(" "),n("li",[t._v("Hybrid 2.0：将 Native 组件覆盖在 WebView 之上，例如微信的 cover-view，提供更多的扩展能力。缺点是：用户体验融合性不好，如层级、事件、布局等。")]),t._v(" "),n("li",[t._v("Hybrid 3.0：前端 DSL 开发，Native 渲染，例如 React Native 与 Weex。缺点：对 W3C 标准能力支持有限，存在平台差异，三端并不完全统一。")]),t._v(" "),n("li",[t._v("Hybrid 4.0：百花齐放的小程序、快应用、轻应用方案，这个容器也有两种：WebView 容器与类 ReatNative 容器。技术方案上并没有太多的花样，这种方案的兴起由微信带起，本质上还是源于各大公司对于流量入口和生态的竞争。")])]),t._v(" "),n("p",[t._v("小程序的特点：")]),t._v(" "),n("ul",[n("li",[t._v("使用 WebView 开发，门槛低，可云端更新。")]),t._v(" "),n("li",[t._v("通过提供基础能力、原生组件结合等方式，提升用户体验。")]),t._v(" "),n("li",[t._v("通过平台发布、审核、下架、封禁等能力，具备对小程序的管控能力。")]),t._v(" "),n("li",[t._v("双线程（逻辑层和渲染层分开），隔离 DOM、BOM 能力，提升体验的同时，可保证 WebView 安全性。")])]),t._v(" "),n("p",[t._v("小程序性能优化：")]),t._v(" "),n("ul",[n("li",[t._v("安装包缓存")]),t._v(" "),n("li",[t._v("分包加载")]),t._v(" "),n("li",[t._v("独立渲染线程")]),t._v(" "),n("li",[t._v("webview 预加载")]),t._v(" "),n("li",[t._v("Native 组件")])]),t._v(" "),n("p",[t._v("可以看出来小程序是介于 Nativa 与 Web 两者间的应用形态，下面我们会从 Native 与 Web 两个不同的角度的看一下小程序的设计原理。")]),t._v(" "),n("h2",{attrs:{id:"重新认识浏览器内核"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#重新认识浏览器内核"}},[t._v("#")]),t._v(" 重新认识浏览器内核")]),t._v(" "),n("p",[t._v("在研究小程序引擎运行原理之前，我们需要对浏览器内核有一些基本认识，这样我们可以更好的理解小程序的设计思路。")]),t._v(" "),n("h3",{attrs:{id:"browser-engine"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#browser-engine"}},[t._v("#")]),t._v(" Browser engine")]),t._v(" "),n("p",[t._v("浏览器内核，浏览器引擎(Browser engine)，也称排版引擎(layout engine)、页面渲染引擎(rendering engine)。浏览器内核无非需要以下几个主要部分，如 HTML/CSS 解析器，网络处理，JavaScript 引擎，2D/3D 图形引擎，多媒体支持等。")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"center"}},[t._v("内核")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("浏览器")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("发布年份")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("发布厂商")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("维护状态")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("JavaScript 引擎")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("Trident")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("IE4 - IE11、360 浏览器")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("1997")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Microsoft")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("停止")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("JScript/Chakra")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("Gecko")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Firefox")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("2004")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Netscape")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("维护")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("SpiderMonkey")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("WebKit")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Safari、Chromium、Chrome(-2013)、Android 浏览器、Chrome OS、Web OS 等")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("2005")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Apple")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("维护")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("JavascriptCore")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("Blink")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Chrome(2013-)、 Opera")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("2013")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Google")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("维护")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("V8")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("Edge")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Edge")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("2015")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Microsoft")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("停止")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Chakra")])])])]),t._v(" "),n("h3",{attrs:{id:"javascript-engine"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#javascript-engine"}},[t._v("#")]),t._v(" JavaScript Engine")]),t._v(" "),n("p",[t._v("目前在 Android／iOS 上运行 JavaScript，主要有两种方法：一种方法是利用系统的浏览器组件 WebView（Android）和 UIWebView／WKWebView（iOS）；另一种方法是编译和集成一个功能全面的 JavaScript 引擎。JavaScript 引擎是一个专门处理 JavaScript 脚本的虚拟机，一般会附带在网页浏览器之中。")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"center"}},[t._v("JavaScript Engine")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("Android")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("iOS")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("维护厂商/个人")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("V8")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("JIT")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("JIT only for jailbroken devices")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Google")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("JavaScriptCore")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Interpreter and JIT")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Interpreter only")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Apple")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("SpiderMonkey")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Interpreter and JIT")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Interpreter only")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Mozilla")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("Rhino")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Interpreter")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Unsupported")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Mozilla")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("quickjs")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("-")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("-")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("Fabrice Bellard")])])])]),t._v(" "),n("h3",{attrs:{id:"how-webkit-works"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#how-webkit-works"}},[t._v("#")]),t._v(" How WebKit works")]),t._v(" "),n("p",[t._v("WebKit 工作原理可以看 "),n("a",{attrs:{href:"https://docs.google.com/presentation/d/1ZRIQbUKw9Tf077odCh66OrrwRIVNLvI_nhLm2Gi__F0/pub?slide=id.p",target:"_blank",rel:"noopener noreferrer"}},[t._v("How WebKit works"),n("OutboundLink")],1),t._v(" 详细介绍。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(596),alt:"Image text"}})]),t._v(" "),n("p",[t._v("WebKit 就是一个页面渲染以及逻辑处理引擎，前端工程师把 HTML、JavaScript、CSS 这“三驾马车”作为输入，经过 WebKit 的处理，就输出成了我们能看到以及操作的 Web 页面。从上图我们可以看出来，WebKit 由图中框住的四个部分组成，而其中最主要的就是 WebCore（KDE 开发的排版引擎） 和 JSCore（或者是其它 JS 引擎）。除此之外，WebKit Embedding API 是负责浏览器 UI 与 WebKit 进行交互的部分，而 WebKit Ports 则是让 Webkit 更加方便的移植到各个操作系统、平台上，提供的一些调用 Native Library 的接口，比如在渲染层面，在 iOS 系统中，Safari 是交给 CoreGraphics 处理，而在 Android 系统中，Webkit 则是交给 Skia。")]),t._v(" "),n("p",[t._v("排版引擎 WebCore 的工作流程:")]),t._v(" "),n("p",[n("img",{attrs:{src:a(597),alt:"Image text"}})]),t._v(" "),n("p",[t._v("JavaScript 引擎 JSCore 的工作流程:")]),t._v(" "),n("p",[n("img",{attrs:{src:a(598),alt:"Image text"}})]),t._v(" "),n("h3",{attrs:{id:"how-blink-works"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#how-blink-works"}},[t._v("#")]),t._v(" How Blink works")]),t._v(" "),n("p",[t._v("Blink 工作原理可以看 "),n("a",{attrs:{href:"http://bit.ly/how-blink-works",target:"_blank",rel:"noopener noreferrer"}},[t._v("How Blink works"),n("OutboundLink")],1),t._v(" 详细介绍。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(599),alt:"Image text"}})]),t._v(" "),n("p",[t._v("Blink 渲染原理: bit.ly/lifeofapixel")]),t._v(" "),n("p",[n("img",{attrs:{src:a(600),alt:"Image text"}})]),t._v(" "),n("h2",{attrs:{id:"主流小程序引擎架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主流小程序引擎架构"}},[t._v("#")]),t._v(" 主流小程序引擎架构")]),t._v(" "),n("p",[t._v("目前主流的小程序平台架构差异不小，但是核心实现设计思路相同，我们可以从这些通用的设计中去思考背后的思想。")]),t._v(" "),n("h3",{attrs:{id:"微信小程序架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微信小程序架构"}},[t._v("#")]),t._v(" 微信小程序架构")]),t._v(" "),n("p",[t._v("微信小程序技术原理可以看之前写的一篇文章"),n("RouterLink",{attrs:{to:"/word/applet-principle.html"}},[t._v("《微信小程序技术原理分析》")]),t._v("。")],1),t._v(" "),n("p",[t._v("微信小程序技术栈系统架构：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(601),alt:"Image text"}})]),t._v(" "),n("p",[t._v("Flutter 渲染优化 - 整体系统架构：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(602),alt:"Image text"}})]),t._v(" "),n("h3",{attrs:{id:"百度小程序架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#百度小程序架构"}},[t._v("#")]),t._v(" 百度小程序架构")]),t._v(" "),n("p",[n("img",{attrs:{src:a(603),alt:"Image text"}})]),t._v(" "),n("h3",{attrs:{id:"支付宝小程序架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#支付宝小程序架构"}},[t._v("#")]),t._v(" 支付宝小程序架构")]),t._v(" "),n("p",[n("img",{attrs:{src:a(604),alt:"Image text"}})]),t._v(" "),n("h3",{attrs:{id:"快应用架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#快应用架构"}},[t._v("#")]),t._v(" 快应用架构")]),t._v(" "),n("p",[n("img",{attrs:{src:a(605),alt:"Image text"}})]),t._v(" "),n("h2",{attrs:{id:"emp-小程序引擎设计"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#emp-小程序引擎设计"}},[t._v("#")]),t._v(" EMP 小程序引擎设计")]),t._v(" "),n("h3",{attrs:{id:"整体架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#整体架构"}},[t._v("#")]),t._v(" 整体架构")]),t._v(" "),n("p",[t._v("JS 层 Framework 架构：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(606),alt:"Image text"}})]),t._v(" "),n("p",[t._v("Native 层 Android 平台小程序容器架构：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(607),alt:"Image text"}})]),t._v(" "),n("p",[t._v("Emp Android SDK 被设计为运行在独立的进程中，独享进程内存，提供了可供小程序运行的丰富的 API 和组件，同时也提供了扩展 API 的能力。SDK 的核心功能主要有两部分: "),n("code",[t._v("逻辑流程控制")]),t._v(" 和 "),n("code",[t._v("API实现")]),t._v("。")]),t._v(" "),n("ul",[n("li",[t._v("逻辑流程控制：SDK Native 层 ["),n("code",[t._v("EmpActivity")]),t._v("] 作为逻辑流程控制中心，建立了页面视图层 ["),n("code",[t._v("Page")]),t._v("] 与应用逻辑层 ["),n("code",[t._v("AppService")]),t._v("] 之间的联系，处理两层之间的事件传递及数据流转，同时也处理 API 的调用并返回结果。")]),t._v(" "),n("li",[t._v("API 实现：SDK 本身提供了丰富的 API 实现，同时也提供了扩展 API 的接口，方便被接入的 App 实现自定义的 API 功能。由于 SDK 运行于独立进程，因此通过进程通信的方式调用宿主提供的扩展 API。")])]),t._v(" "),n("h3",{attrs:{id:"包结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#包结构"}},[t._v("#")]),t._v(" 包结构")]),t._v(" "),n("p",[t._v("小程序开发工程以微信小程序工程作为输入，经过编译器编译后生成如下结构的包。其中 framework 包独立于小程序包，通常内置于小程序引擎内。")]),t._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("├── framework            # 框架内置包\n|   ├── service.js       # 框架 AppService 层\n|   ├── view.js          # 框架 PageView 层\n|   └── framework.css    # 框架通用样式\n├── pages                # 视图层入口\n|   ├── index/index.html\n|   ├── ...\n├── assets               # 静态资源\n├── scripts\n|   ├── app-config.js    # 全局配置\n|   └── app-service.js   # 应用逻辑层\n└── service.html         # 逻辑层入口\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br")])]),n("h3",{attrs:{id:"启动流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动流程"}},[t._v("#")]),t._v(" 启动流程")]),t._v(" "),n("p",[t._v("小程序引擎 Android 平台小程序启动流程图：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(608),alt:"Image text"}})]),t._v(" "),n("h3",{attrs:{id:"编译器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编译器"}},[t._v("#")]),t._v(" 编译器")]),t._v(" "),n("p",[t._v("大多数编译器流程可以分为三个阶段：")]),t._v(" "),n("ul",[n("li",[t._v("解析(parse)：将代码字符串解析成抽象语法树；")]),t._v(" "),n("li",[t._v("转换(transform)：对抽象语法树进行转换操作；")]),t._v(" "),n("li",[t._v("生成(generate): 根据变换后的抽象语法树再生成代码字符串。")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(609),alt:"Image text"}})]),t._v(" "),n("p",[t._v("根据 HTML、JS、CSS 不同的语法规则，采用不同的中间编译工具，Unified、Babel、PostCSS 都支持插件系统。中间转换插件主要解决语法转换，wxml2vue 核心逻辑主要是提供了将小程序文件编译成能够用于 Vue 框架运行的代码。")]),t._v(" "),n("h4",{attrs:{id:"属性转换"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#属性转换"}},[t._v("#")]),t._v(" 属性转换")]),t._v(" "),n("p",[t._v("将微信小程序标签上的属性绑定语法变为 Vue 绑定语法，如：")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"center"}},[t._v("微信小程序")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("Vue")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v('id="item"')]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v('id="item"')])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v('id=""')]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v(':id="item"')])])])]),t._v(" "),n("p",[n("strong",[t._v("Class 转换")])]),t._v(" "),n("p",[t._v("WXML 源代码:")]),t._v(" "),n("div",{staticClass:"language-xml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("view")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("static-class {{ dynamicClassFlag ? "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("dynamic-class"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v(": "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("}}"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Class"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("view")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("p",[t._v("AST 转换代码：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 判断是否{{}}数据绑定\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("hasDataBindBrackets")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("{{(.+?)}}")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("trim")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 获取{{}}数据绑定模板表达式\n * @param {*} value\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("removeDataBindBrackets")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" match "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isEmptyString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("{{(.+?)}}")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("exec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("match "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" match"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("trim")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("transformClassAtrr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("node")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" attribs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" attribs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("attr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasDataBindBrackets")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    attribs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'class'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("split")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("{{.+?}}")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("' '")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("trim")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    attribs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'v-bind:class'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeDataBindBrackets")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" attribs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br")])]),n("p",[t._v("经过 AST 转换后生成代码为：")]),t._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("&lt;ui-view class=\"static-class\" v-bind:class=\"dynamicClassFlag ? 'dynamic-class': ''\">Class&lt;/ui-view>\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("h4",{attrs:{id:"指令转换"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#指令转换"}},[t._v("#")]),t._v(" 指令转换")]),t._v(" "),n("p",[t._v("将微信小程序的指令转换为 Vue 指令：")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"center"}},[t._v("微信小程序")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("Vue")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v('wx:for="" wx:for-item="xxx"wx:for-index="yyy"')]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v('v-for="(xxx, yyy) in array"')])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("wx:if")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("v-if")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("wx:elif")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("v-else-if")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("wx:else")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("v-else")])])])]),t._v(" "),n("h4",{attrs:{id:"组件转换"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#组件转换"}},[t._v("#")]),t._v(" 组件转换")]),t._v(" "),n("p",[t._v("将微信小程序组件转换为 Vue 组件。")]),t._v(" "),n("h4",{attrs:{id:"事件转换"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#事件转换"}},[t._v("#")]),t._v(" 事件转换")]),t._v(" "),n("p",[t._v("引入手势库"),n("a",{attrs:{href:"http://hammerjs.github.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("hammerjs"),n("OutboundLink")],1),t._v("，默认支持 Tap、Press、Swipe、Pan、Pinch、Rotate 等基本手势。")]),t._v(" "),n("p",[t._v("WXML 源代码:")]),t._v(" "),n("div",{staticClass:"language-xml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("primary"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("data-type")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("tap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("bindtap")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("showToast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("tap"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("primary"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("data-type")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("longpress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("bindlongpress")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("showToast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("longpress"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])]),n("p",[t._v("AST 转换代码：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("transformOnDirective")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("attr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" eventType "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" attr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("substring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" eventName "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" newAttr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" attr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventType"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'touchstart'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'touchmove'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'touchcancel'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'touchend'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'transitionend'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'animationstart'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'animationiteration'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'animationend'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'touchforcechange'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      newAttr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("v-on:")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("eventType"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tap'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      newAttr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'v-on:tap.native'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'longtap'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'longpress'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      newAttr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'v-on:press.native'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("warn")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'不支持的事件: '")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eventType"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    attr"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" newAttr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    value"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("__eventHandleProxy__('")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("eventName"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("', $event)")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br")])]),n("p",[t._v("经过 AST 转换后生成代码为：")]),t._v(" "),n("div",{staticClass:"language-xml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ui-button")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("primary"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("data-type")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("tap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("v-on:")]),t._v("tap.native")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("__eventHandleProxy__("),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("showToast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v(", $event)"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("tap"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("ui-button")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ui-button")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("primary"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("data-type")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("longpress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("v-on:")]),t._v("press.native")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("__eventHandleProxy__("),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("showToast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v(", $event)"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("longpress"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("ui-button")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])]),n("p",[t._v("小程序框架试视图层：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("vm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  data"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  render"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("render"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  methods"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("__eventHandleProxy__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("eventName"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Event")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 转发 Page 事件到 AppService")]),t._v("\n      global"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("emp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("publishPageEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eventTransform"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("intercept")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br")])]),n("h3",{attrs:{id:"通信机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#通信机制"}},[t._v("#")]),t._v(" 通信机制")]),t._v(" "),n("h4",{attrs:{id:"javascript-层设计"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#javascript-层设计"}},[t._v("#")]),t._v(" JavaScript 层设计")]),t._v(" "),n("p",[t._v("JSBridge 中有 invoke、invokeCallbackHandler、on、publish、subscribe、subscribeHandler 五个方法，下面会逐个介绍其作用与实现。")]),t._v(" "),n("div",{staticClass:"language-ts line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JSBridge")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" callbackIndex"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" eventPrefix"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'custom_event_'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" callbacks"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Map"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Function")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" defaultEventHandlers"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Map"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Function")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" handlers"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Map"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Function")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * 逻辑层 JS 层异步调用 Native 层\n   * @param {*} event\n   * @param {*} params\n   * @param {*} callback\n   */")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("invoke")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" paramsString "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" callbackId "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callbackIndex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callbacks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callbackId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isAndroid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" JSCoreHandleResult "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" global"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EmpJSCore"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("invokeHandler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" paramsString"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callbackId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" callback "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callbacks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callbackId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isUndefined")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("JSCoreHandleResult"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isFunction")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" JSCoreHandleResult "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          JSCoreHandleResult "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("JSCoreHandleResult"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          JSCoreHandleResult "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("JSCoreHandleResult"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callbacks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callbackId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isIOS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      global"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webkit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("messageHandlers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("invokeHandler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("C")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" eventName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        paramsString"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        callbackId\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * Native 层将 invoke 回调结果传递给 JS 层\n   * @param {*} callbackId\n   * @param {*} params\n   */")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("invokeCallbackHandler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callbackId"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" callback "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callbacks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callbackId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isFunction")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callbacks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callbackId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * 监听默认事件\n   * @param {*} eventName\n   * @param {*} handler\n   */")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" handler"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("defaultEventHandlers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * 发布消息，由 Service 层或 View 层的 JSBridge 调用\n   * @param {*} eventName\n   * @param {*} params\n   * @param {*} webviewIds\n   */")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("publish")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" webviewIds"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" event "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("eventPrefix "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" eventName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" paramsString "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    webviewIds "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("webviewIds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isAndroid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      global"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EmpJSCore"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("publishHandler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" paramsString"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" webviewIds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isIOS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      global"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webkit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("messageHandlers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("publishHandler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        paramsString"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        webviewIds\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * 订阅消息\n   * @param {*} eventName\n   * @param {*} handler\n   */")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("subscribe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" handler"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("handlers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("eventPrefix "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" eventName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * 消息订阅处理器\n   * @param {*} eventName\n   * @param {*} data\n   * @param {*} webviewId\n   * @param {*} reportParams\n   */")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("subscribeHandler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" webviewId"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" handler "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("includes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("eventPrefix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("handlers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("defaultEventHandlers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isFunction")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("handler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" webviewId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nglobal"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EmpJSBridge "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JSBridge")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br"),n("span",{staticClass:"line-number"},[t._v("37")]),n("br"),n("span",{staticClass:"line-number"},[t._v("38")]),n("br"),n("span",{staticClass:"line-number"},[t._v("39")]),n("br"),n("span",{staticClass:"line-number"},[t._v("40")]),n("br"),n("span",{staticClass:"line-number"},[t._v("41")]),n("br"),n("span",{staticClass:"line-number"},[t._v("42")]),n("br"),n("span",{staticClass:"line-number"},[t._v("43")]),n("br"),n("span",{staticClass:"line-number"},[t._v("44")]),n("br"),n("span",{staticClass:"line-number"},[t._v("45")]),n("br"),n("span",{staticClass:"line-number"},[t._v("46")]),n("br"),n("span",{staticClass:"line-number"},[t._v("47")]),n("br"),n("span",{staticClass:"line-number"},[t._v("48")]),n("br"),n("span",{staticClass:"line-number"},[t._v("49")]),n("br"),n("span",{staticClass:"line-number"},[t._v("50")]),n("br"),n("span",{staticClass:"line-number"},[t._v("51")]),n("br"),n("span",{staticClass:"line-number"},[t._v("52")]),n("br"),n("span",{staticClass:"line-number"},[t._v("53")]),n("br"),n("span",{staticClass:"line-number"},[t._v("54")]),n("br"),n("span",{staticClass:"line-number"},[t._v("55")]),n("br"),n("span",{staticClass:"line-number"},[t._v("56")]),n("br"),n("span",{staticClass:"line-number"},[t._v("57")]),n("br"),n("span",{staticClass:"line-number"},[t._v("58")]),n("br"),n("span",{staticClass:"line-number"},[t._v("59")]),n("br"),n("span",{staticClass:"line-number"},[t._v("60")]),n("br"),n("span",{staticClass:"line-number"},[t._v("61")]),n("br"),n("span",{staticClass:"line-number"},[t._v("62")]),n("br"),n("span",{staticClass:"line-number"},[t._v("63")]),n("br"),n("span",{staticClass:"line-number"},[t._v("64")]),n("br"),n("span",{staticClass:"line-number"},[t._v("65")]),n("br"),n("span",{staticClass:"line-number"},[t._v("66")]),n("br"),n("span",{staticClass:"line-number"},[t._v("67")]),n("br"),n("span",{staticClass:"line-number"},[t._v("68")]),n("br"),n("span",{staticClass:"line-number"},[t._v("69")]),n("br"),n("span",{staticClass:"line-number"},[t._v("70")]),n("br"),n("span",{staticClass:"line-number"},[t._v("71")]),n("br"),n("span",{staticClass:"line-number"},[t._v("72")]),n("br"),n("span",{staticClass:"line-number"},[t._v("73")]),n("br"),n("span",{staticClass:"line-number"},[t._v("74")]),n("br"),n("span",{staticClass:"line-number"},[t._v("75")]),n("br"),n("span",{staticClass:"line-number"},[t._v("76")]),n("br"),n("span",{staticClass:"line-number"},[t._v("77")]),n("br"),n("span",{staticClass:"line-number"},[t._v("78")]),n("br"),n("span",{staticClass:"line-number"},[t._v("79")]),n("br"),n("span",{staticClass:"line-number"},[t._v("80")]),n("br"),n("span",{staticClass:"line-number"},[t._v("81")]),n("br"),n("span",{staticClass:"line-number"},[t._v("82")]),n("br"),n("span",{staticClass:"line-number"},[t._v("83")]),n("br"),n("span",{staticClass:"line-number"},[t._v("84")]),n("br"),n("span",{staticClass:"line-number"},[t._v("85")]),n("br"),n("span",{staticClass:"line-number"},[t._v("86")]),n("br"),n("span",{staticClass:"line-number"},[t._v("87")]),n("br"),n("span",{staticClass:"line-number"},[t._v("88")]),n("br"),n("span",{staticClass:"line-number"},[t._v("89")]),n("br"),n("span",{staticClass:"line-number"},[t._v("90")]),n("br"),n("span",{staticClass:"line-number"},[t._v("91")]),n("br"),n("span",{staticClass:"line-number"},[t._v("92")]),n("br"),n("span",{staticClass:"line-number"},[t._v("93")]),n("br"),n("span",{staticClass:"line-number"},[t._v("94")]),n("br"),n("span",{staticClass:"line-number"},[t._v("95")]),n("br"),n("span",{staticClass:"line-number"},[t._v("96")]),n("br"),n("span",{staticClass:"line-number"},[t._v("97")]),n("br"),n("span",{staticClass:"line-number"},[t._v("98")]),n("br"),n("span",{staticClass:"line-number"},[t._v("99")]),n("br"),n("span",{staticClass:"line-number"},[t._v("100")]),n("br"),n("span",{staticClass:"line-number"},[t._v("101")]),n("br"),n("span",{staticClass:"line-number"},[t._v("102")]),n("br"),n("span",{staticClass:"line-number"},[t._v("103")]),n("br"),n("span",{staticClass:"line-number"},[t._v("104")]),n("br"),n("span",{staticClass:"line-number"},[t._v("105")]),n("br"),n("span",{staticClass:"line-number"},[t._v("106")]),n("br"),n("span",{staticClass:"line-number"},[t._v("107")]),n("br"),n("span",{staticClass:"line-number"},[t._v("108")]),n("br"),n("span",{staticClass:"line-number"},[t._v("109")]),n("br")])]),n("p",[t._v("JS 层主动调用 Native 层：JS 层逻辑层使用 EmpJSBridge.invoke 异步调用 Native 层，Native 层将 invoke 方法的回调结果通过 Native 层调用 JS 层的 JSBridge.invokeCallbackHandler 方法回调给 JS 层。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(610),alt:"Image text"}})]),t._v(" "),n("p",[t._v("JS 层监听 Native 层的消息：EmpJSBridge.on 方法主要用于监听来自 Native 层主动发送的消息，例如 onPullDownRefresh、onShareAppMessage 等。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(611),alt:"Image text"}})]),t._v(" "),n("p",[t._v("JS 层逻辑层与视图层的消息通信：Service 层或 View 层的 JSBridge 调用 EmpJSBridge.publish 发布消息，publish 发布的消息首先会发给 Native 层，Native 层收到消息后经过处理会调用 JS 层的 EmpJSBridge.subscribeHandler 方法，通过 EmpJSBridge.subscribe 实现消息订阅。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(612),alt:"Image text"}})]),t._v(" "),n("h4",{attrs:{id:"android-层设计"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#android-层设计"}},[t._v("#")]),t._v(" Android 层设计")]),t._v(" "),n("p",[t._v("JSBridge 中的 invoke 方法和 publish 方法在不同平台调用不同的方法：Android 平台调用 EmpJSCore.invokeHandler / EmpJSCore.publishHandler 方法，iOS 平台调用 webkit.messageHandlers.invokeHandler.postMessage。这里的 JSCore 对象通过 WebView addJavascriptInterface 方法对外暴露接口。")]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addJavascriptInterface")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JSInterface")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"EmpJSCore"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("p",[t._v("以 "),n("code",[t._v("mpJSCore.invokeHandler")]),t._v(" 为例说明，JSInterface 接口实现如下，EmpJSCore.invokeHandler 将 JS 层传递过来的 eventName、paramsString、callbackId 三个参数传入到 mBridgeHandler.invoke 方法中。")]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JSInterface")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" TAG "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"JSInterface"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IBridge")]),t._v(" mBridgeHandler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Handler")]),t._v(" mHandler "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Handler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Looper")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMainLooper")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JSInterface")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IBridge")]),t._v(" handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        mBridgeHandler "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@JavascriptInterface")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("publishHandler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" viewIds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EmpTrace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("d")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TAG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"publishHandler is called! event=%s, params=%s, viewIds=%s"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" viewIds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        mHandler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Runnable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mBridgeHandler "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    mBridgeHandler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("publish")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" viewIds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@JavascriptInterface")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("invokeHandler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" callbackId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EmpTrace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("d")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TAG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"invokeHandler is called! event=%s, params=%s, callbackId=%s"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callbackId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        mHandler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Runnable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mBridgeHandler "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    mBridgeHandler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("invoke")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callbackId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br"),n("span",{staticClass:"line-number"},[t._v("37")]),n("br")])]),n("p",[t._v("这里的 mBridgeHandler 是一个 IBridge 接口实现类实例，具体实现在 AppService 和 Page 中，mBridgeHandler.invoke 方法具体实现为：")]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("invoke")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" callbackId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EmpTrace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("d")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TAG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api invoke, event=%s, params=%s, callbackId=%s"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callbackId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Event")]),t._v(" e "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Event")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callbackId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  mApisManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("invoke")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("p",[t._v("Native 层调用 API Manager 的invoke 方法实现功能调用，处理完成后 Native 层调用 AppService 层的 callback 方法实现消息回调：")]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" callbackId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  mServiceWebView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadUrl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"javascript:EmpJSBridge.invokeCallbackHandler(%s,%s)"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callbackId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("h4",{attrs:{id:"视图层与逻辑层通信"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#视图层与逻辑层通信"}},[t._v("#")]),t._v(" 视图层与逻辑层通信")]),t._v(" "),n("p",[t._v("视图层 DOM Ready、点击等操作事件通过 bridge.publish 发布事件消息：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 发布页面事件\n * @param {string} eventName 事件名称\n * @param {any} data 事件数据\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("publishPageEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("eventName"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  bridge"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("publish")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("EventType"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PAGE_EVENT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    eventName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    data\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br")])]),n("p",[t._v("逻辑层监听事件：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 订阅页面事件\n * @param {*} fn\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onWebviewEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("callback"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  bridge"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("subscribe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("EventType"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PAGE_EVENT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("EMP")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PageEventData"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" webviewId"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" number")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" event "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("assign")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" webviewId "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    global"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("__empconsole__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'AppService'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("Subscribe PageEvent: data: ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v(", webviewId: ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("webviewId"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br")])]),n("h2",{attrs:{id:"参考"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),n("ul",[n("li",[n("p",[n("RouterLink",{attrs:{to:"/word/applet.html"}},[t._v("小程序学习资源")])],1)]),t._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/81775922",target:"_blank",rel:"noopener noreferrer"}},[t._v("小程序底层实现原理及一些思考"),n("OutboundLink")],1)])]),t._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://mp.weixin.qq.com/s/Q3Dfrcf5FTmWUrsIkPWncA",target:"_blank",rel:"noopener noreferrer"}},[t._v("小程序技术演进史"),n("OutboundLink")],1)])])])],1)}),[],!1,null,null,null);s.default=e.exports}}]);